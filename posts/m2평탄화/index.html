<!doctype html>
<html lang="ko-kr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M2평탄화 | 둥충코딩</title>
    <meta name="description" content="" />

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@400;600&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

      
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>

    <style>

      @import url("https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400&display=swap");

      body {
        margin: 0;
        padding: 0;
         
        font:400 16px 'Noto Serif KR', serif;
        line-height: 1.6;
        color: #4a4b4f;
        background-color: #fbfbfb;
      }

      .container {
        max-width: 780px;  
        margin: 0 auto;
        padding: 60px 20px;
      }

      h1 {
        margin: 0 0 40px 0;
        color: #4a4b4f;
      }

      p {
        margin: 0 0 20px 0;
        line-height: 1.7;
      }

      a {
        color: #8f6a60;
        text-decoration: underline;
        text-decoration-thickness: 1px;
        text-underline-offset: 2px;
      }

      a:hover {
        color: #6b5046;
      }

      .section {
        margin-bottom: 40px;
      }

      .works-title {
        font-weight: 600;
        margin-bottom: 15px;
        color: #4a4b4f;
      }

      .work-item {
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .work-link {
        display: block;
        text-decoration: none;
        color: #4a4b4f;
      }

      .work-link:hover {
        opacity: 0.8;
      }

      .work-title {
        font-weight: 500;
      }

      .publication {
        color: #8f6a60;
      }

      .year {
        color: #9d9d9d;
      }

      .description {
        color: #9d9d9d;
        font-style: italic;
        margin-top: 4px;
      }

      .contact {
        margin-top: 50px;
        padding-top: 30px;
        border-top: 1px solid #e5e5e5;
      }

      .footer-image {
        margin-top: 30px;
        text-align: left;
      }

      .footer-image img {
        width: 60px;
        height: auto;
        opacity: 0.7;
      }

      @media (max-width: 768px) {
        .container {
          padding: 40px 20px;
        }

        h1 {
          font-size: 22px;
        }

        body {
          font-size: 15px;
        }
      }
      
       
      pre {
        background-color: #f5f5f5;
        padding: 16px;
        border-radius: 4px;
        overflow-x: auto;
        margin: 20px 0;
      }
      
      code {
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 14px;
        line-height: 1.5;
      }
      
      pre code {
        display: block;
        white-space: pre !important;
        word-wrap: normal !important;
        word-break: normal;
        overflow-x: auto;
      }
      
       
      p code, li code, h1 code, h2 code, h3 code {
        background-color: #f5f5f5;
        padding: 3px 5px;
        border-radius: 3px;
        font-size: 0.9em;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

       
      .post-content mjx-container[display="true"] {
        display: block;
        text-align: center;
        margin: 1em 0;
        overflow-x: auto !important;
        overflow-y: visible !important;
        max-width: 100% !important;
        width: 100% !important;
        box-sizing: border-box;
        padding-top: 1em;
        padding-bottom: 1em;
        min-height: unset;
      }
       
      .post-content mjx-container[display="true"] mjx-math {
        min-width: 0 !important;
        max-width: 100% !important;
        overflow-x: auto !important;
        overflow-y: visible !important;
        white-space: pre;
        box-sizing: border-box;
        min-height: unset;
      }
       
      .post-content {
        overflow-x: auto;
        overflow-y: visible;
      }
      
       
      .post-content img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin-top: 1.5em;
        margin-bottom: 1.5em;
      }
      
       
      .post-content img + em {
        display: block;
        text-align: center;
        font-size: 0.9em;
        color: #777;
        margin-top: -1em;
        margin-bottom: 1.5em;
      }

        .toc {
    border: thin solid ;
    padding: 1rem;
  }

    </style>

    <style>
 
.chatlog {
  font-family: 'Inter', 'Roboto', 'Noto Sans KR', sans-serif;
  font-size: 0.98rem;
  line-height: 1.75;
  color: #333;
  border: 1px solid ;
  border-radius: 10px;
  max-width: 580px;
  margin: 0 auto;
        padding: 20px 20px;
}

 
.chatlog table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5rem 0;
  font-size: 0.95rem;
}

.chatlog th,
.chatlog td {
  border: 1px solid #ddd;
  padding: 0.75rem;
  text-align: left;
}

.chatlog thead {
  background-color: #f0f0f5;
  font-weight: 600;
}

.chatlog tbody tr:nth-child(even) {
  background-color: #fafafa;
}

 
.chatlog pre {
  background-color: #f5f5f7;
  padding: 1rem;
  overflow-x: auto;
  border-radius: 6px;
  font-size: 0.92rem;
  line-height: 1.6;
  margin: 1.5rem 0;
}

.chatlog code {
  font-family: 'Courier New', monospace;
  color: #2c3e50;
}

 
.chatlog p code {
  background-color: #eef1f5;
  padding: 0.2rem 0.4rem;
  border-radius: 4px;
  font-size: 0.95em;
}
.user-bubble {
  background-color: #cdcdcd;
  border-radius: 16px 16px 0 16px;  
  padding: 0.8em 1.2em;
  margin: 0.5em 0 0.5em auto;  
  max-width: 80%;
  display: inline-block;
  position: relative;
}

.user-bubble::before {
  content: "";
  position: absolute;
  left: -10px;
  top: 10px;
  border: 6px solid transparent;
  border-right-color: #cdcdcd;
}

.gpt-line {
  margin: 0.5em 0;
}
    </style>
  </head>
  <body>
    <div class="container">
      
<style>
  .post-container {
    max-width: 780px;  
    margin: 0 auto;
    padding: 0 20px;
  }
  
  .post-header {
    margin-bottom: 40px;
  }
  
  .post-title {
    margin-bottom: 10px;
    color: #4a4b4f;
  }
  
  .post-date {
    color: #9d9d9d;
    font-style: italic;
    margin-bottom: 20px;
  }
  
  .post-description {
    font-style: italic;
    color: #666;
    margin-bottom: 30px;
    font-size: 17px;
  }
  
  .post-content {
    line-height: 1.8;
  }
  
  .post-content h2 {
    margin: 30px 0 20px 0;
    color: #4a4b4f;
  }
  
  .post-content p {
    margin-bottom: 20px;
  }
  
  .post-content img {
    display: block;
    width: 80%;
    max-width: 80%;
    height: auto;
    margin: 2rem auto;
    border-radius: 4px;
  }
  
   
  .post-content img + em {
    display: block;
    text-align: center;
    font-size: 0.9em;
    color: #777;
    margin-top: -0.5rem;
    margin-bottom: 2rem;
  }
  
  .post-content em {
    color: #666;
  }
  
  .back-link {
    display: inline-block;
    margin-top: 50px;
    margin-bottom: 30px;
    color: #8f6a60;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }
  
  .back-link:hover {
    color: #6b5046;
  }
</style>

<div class="post-container">
  <div class="post-header">
    <h1 class="post-title">M2평탄화</h1>
    <div class="post-date">May 4, 2021</div>
  </div>
  
    
        <aside  class="toc" >
            <nav id="TableOfContents">
  <ul>
    <li><a href="#데이터-수집하기">데이터 수집하기</a>
      <ul>
        <li><a href="#m2-구하기">M2 구하기</a></li>
        <li><a href="#지수-구하기">지수 구하기</a></li>
      </ul>
    </li>
    <li><a href="#m2평탄화-하기">M2평탄화 하기</a>
      <ul>
        <li><a href="#데이터-merge">데이터 Merge</a></li>
        <li><a href="#interpolation">Interpolation</a></li>
        <li><a href="#새로운-열-구하기">새로운 열 구하기</a></li>
      </ul>
    </li>
    <li><a href="#차트-그리기">차트 그리기</a></li>
    <li><a href="#개인적-생각">개인적 생각</a></li>
  </ul>
</nav>
        </aside>
    

  <div class="post-content">
    <h1 id="m2-평탄화">M2 평탄화</h1>
<p>이 페이지에서 말하는 M2란 광의통화를 의미한다.
작년 2020년 코로나가 전세계로 급속도로 번지면서 경제가 급격히 얼어붙었다.
그래서 2020년 3월 미국의 FED에서 돈을 엄청나게 많이 뿌리며
금융 충격에 대비하였고 이에 대부분의 자산은 급격한 반등을 이루게 되었다.</p>
<p>이 과정에서 M2 통화량 증가분을 제거하면 어느정도 수준으로 반등이 이루어졌는지
파악해볼수 있지 않을까? 하는 아이디어에서 M2 영향도를 제거하는
차트를 그려보는 간단한 개발을 하였다. 이는 작년 9~10월 정도에
python으로 개발하였다.</p>
<p><a href="https://doongchoong.github.io/m2flat/index.html">M2flat Demo</a>사이트</p>
<h2 id="데이터-수집하기">데이터 수집하기</h2>
<p>먼저 데이터가 필요한데 구할 데이터는 명확하다. M2, 그리고 각 지수 데이터이다.
M2는 <a href="https://fred.stlouisfed.org">FRED</a> 사이트에서
지수데이터는 <a href="https://finance.yahoo.com/">Yahoo finance</a>에서 구한다.
CSV형태로 바로 다운받을 수 있게 제공하고 있다.</p>
<h3 id="m2-구하기">M2 구하기</h3>
<p>구글에서 <code>fred m2</code> 라고 검색하면 된다.
<a href="https://fred.stlouisfed.org/series/M2">FRED M2</a> 사이트가 나오는데
M2의 대한 그래프가 나온다.</p>
<p><img src="/img/m2_graph.PNG" alt="M2 img">
(2021.05.04 현재 데이터 제공 중단. <a href="https://fred.stlouisfed.org/series/M2SL">한달간격의 데이터로 변경됨</a>)</p>
<p>2020년 3월에 급격히 증가한 M2를 보면 유동성 공급이 얼마나 어마어마 했는지 알수 있다.</p>
<p>위에서 Download-&gt;CSV-Data 에 링크를 얻어보자</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>https://fred.stlouisfed.org/graph/fredgraph.csv?bgcolor=%23e1e9f0&amp;chart_type=line
</span></span><span style="display:flex;"><span>&amp;drp=0&amp;fo=open%20sans&amp;graph_bgcolor=%23ffffff
</span></span><span style="display:flex;"><span>&amp;height=450&amp;mode=fred&amp;recession_bars=on&amp;txtcolor=%23444444&amp;ts=12&amp;tts=12&amp;width=1168&amp;nt=0&amp;thu=0
</span></span><span style="display:flex;"><span>&amp;trc=0&amp;show_legend=yes&amp;show_axis_titles=yes&amp;show_tooltip=yes&amp;id=M2&amp;scale=left
</span></span><span style="display:flex;"><span>&amp;cosd=1980-11-03&amp;coed=2021-02-01&amp;line_color=%234572a7&amp;link_values=false
</span></span><span style="display:flex;"><span>&amp;line_style=solid&amp;mark_type=none&amp;mw=3&amp;lw=2&amp;ost=-99999&amp;oet=99999&amp;mma=0
</span></span><span style="display:flex;"><span>&amp;fml=a&amp;fq=Weekly%2C%20Ending%20Monday&amp;fam=avg&amp;fgst=lin
</span></span><span style="display:flex;"><span>&amp;fgsnd=2020-02-01&amp;line_index=1&amp;transformation=lin&amp;vintage_date=2021-05-04&amp;revision_date=2021-05-04&amp;nd=1980-11-03
</span></span></code></pre></div><p>엄청나게 긴 URL이 나온다. 저런식으로 ? 뒤에 key=value&amp; 식으로 계속 붙는 모양을 <code>query string</code>
이라고 한다. 서버에서는 Key,value값을 이용하여 적당히 가공을 하여 요청에 응답을 주게 된다.
이중에 1980년도의 일자는 왠지 from 날짜 같고 2021년도 일자들은 to날짜에 가까워 보인다.
따라서 요즘 날짜들을 구하여 포맷팅으로 넣을수 있도록 날짜를 <code>%s</code> 로 대치한다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>furl <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;https://fred.stlouisfed.org/graph/fredgraph.csv?b...긴URL&#39;</span>
</span></span><span style="display:flex;"><span>tdy <span style="color:#0550ae">=</span> datetime<span style="color:#0550ae">.</span>datetime<span style="color:#0550ae">.</span>today<span style="color:#1f2328">()</span><span style="color:#0550ae">.</span>strftime<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;%Y-%m-</span><span style="color:#0a3069">%d</span><span style="color:#0a3069">&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>url <span style="color:#0550ae">=</span> furl<span style="color:#0550ae">%</span><span style="color:#1f2328">(</span>tdy<span style="color:#1f2328">,</span>tdy<span style="color:#1f2328">,</span>tdy<span style="color:#1f2328">,</span>tdy<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">with</span> urllib<span style="color:#0550ae">.</span>request<span style="color:#0550ae">.</span>urlopen<span style="color:#1f2328">(</span>url<span style="color:#1f2328">)</span> <span style="color:#cf222e">as</span> response<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>	html <span style="color:#0550ae">=</span> response<span style="color:#0550ae">.</span>read<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#cf222e">with</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;M2.csv&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;wb&#39;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">as</span> save_file<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>		save_file<span style="color:#0550ae">.</span>write<span style="color:#1f2328">(</span>html<span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>이런식으로 오늘일자를 넣어 조립하게 되면 항상 최신날짜로 url이 생성될 것이다.
python의 with문은 syntax sugar에 가깝다. <code>__enter__, __exit__</code> 메소드를 구현하면
시작될 때와 끝날 때 자동으로 호출되게 된다.
IO 작업시  열고-닫는 한 과정을 감싸는 형태의 패턴으로 많이 사용한다.
URL open IO 그리고 파일IO 두개를 사용한다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>DATE,M2
</span></span><span style="display:flex;"><span>1980-11-03,1591.4
</span></span><span style="display:flex;"><span>1980-11-10,1592.9
</span></span><span style="display:flex;"><span>1980-11-17,1596.3
</span></span><span style="display:flex;"><span>1980-11-24,1597.2
</span></span><span style="display:flex;"><span>1980-12-01,1596.1
</span></span><span style="display:flex;"><span>1980-12-08,1597.0
</span></span><span style="display:flex;"><span>1980-12-15,1599.5
</span></span><span style="display:flex;"><span>1980-12-22,1599.3
</span></span><span style="display:flex;"><span>1980-12-29,1595.6
</span></span><span style="display:flex;"><span>1981-01-05,1596.6
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>M2.csv 파일은 위와 같은 내용이 담겨지게 된다. 일자가 7일 간격인 것을 볼수 있다.</p>
<h3 id="지수-구하기">지수 구하기</h3>
<p>Yahoo finance에서 <a href="https://finance.yahoo.com/quote/%5EIXIC/history?p=%5EIXIC">IXIC(나스닥) Historical Data</a>
눌러서 보면 Download 링크가 있다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>https://query1.finance.yahoo.com/v7/finance/download/%5EIXIC?
</span></span><span style="display:flex;"><span>period1=1588599485&amp;period2=1620135485&amp;interval=1d
</span></span><span style="display:flex;"><span>&amp;events=history&amp;includeAdjustedClose=true
</span></span></code></pre></div><p>period1, period2 가 From, To 역할을 하는것으로 보이며 시간이 숫자형태로 나와있는데
저런 경우는 십중팔구 Unix-time 이다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>stime <span style="color:#0550ae">=</span> datetime<span style="color:#0550ae">.</span>datetime<span style="color:#0550ae">.</span>now<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>etime <span style="color:#0550ae">=</span> datetime<span style="color:#0550ae">.</span>datetime<span style="color:#0550ae">.</span>now<span style="color:#1f2328">()</span> <span style="color:#0550ae">-</span> datetime<span style="color:#0550ae">.</span>timedelta<span style="color:#1f2328">(</span>days<span style="color:#0550ae">=</span><span style="color:#0550ae">365</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>stime<span style="color:#1f2328">,</span> etime<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ustime <span style="color:#0550ae">=</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">(</span>stime<span style="color:#0550ae">.</span>timestamp<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span>uetime <span style="color:#0550ae">=</span> <span style="color:#6639ba">int</span><span style="color:#1f2328">(</span>etime<span style="color:#0550ae">.</span>timestamp<span style="color:#1f2328">())</span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>ustime<span style="color:#1f2328">,</span> uetime<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>furl <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;https://query1.finance.yahoo.com/v7/finance/download/</span><span style="color:#0a3069">%%</span><span style="color:#0a3069">5E</span><span style="color:#0a3069">%s</span><span style="color:#0a3069">?period1=</span><span style="color:#0a3069">%s</span><span style="color:#0a3069">&amp;period2=</span><span style="color:#0a3069">%s</span><span style="color:#0a3069">&amp;interval=1d&amp;events=history&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6639ba">print</span><span style="color:#1f2328">(</span>furl<span style="color:#0550ae">%</span><span style="color:#1f2328">(</span>symbol<span style="color:#1f2328">,</span> uetime<span style="color:#1f2328">,</span> ustime<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">with</span> urllib<span style="color:#0550ae">.</span>request<span style="color:#0550ae">.</span>urlopen<span style="color:#1f2328">(</span>furl<span style="color:#0550ae">%</span><span style="color:#1f2328">(</span>symbol<span style="color:#1f2328">,</span> uetime<span style="color:#1f2328">,</span> ustime<span style="color:#1f2328">))</span> <span style="color:#cf222e">as</span> response<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>	html <span style="color:#0550ae">=</span> response<span style="color:#0550ae">.</span>read<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#cf222e">with</span> <span style="color:#6639ba">open</span><span style="color:#1f2328">(</span>symbol <span style="color:#0550ae">+</span> <span style="color:#0a3069">&#39;.csv&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;wb&#39;</span><span style="color:#1f2328">)</span> <span style="color:#cf222e">as</span> save_file<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>		save_file<span style="color:#0550ae">.</span>write<span style="color:#1f2328">(</span>html<span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>현재시간을 구하고 현재시간에서 365일전 시간을 구한뒤에
각각의 timestamp를 구하고 이를 url 에 넣어 조립한다.
그뒤 URL Open , 파일저장 순이다.</p>
<p>Yahoo에서는 지수인 경우는 심볼 앞에 <code>^</code> 문자를 붙이는데 이는 URL encode가 되면
%에 5E 가 붙은것을 볼수 있다. 5E는 <a href="https://ko.wikipedia.org/wiki/ASCII">아스키코드</a>
참조하면 된다.
주의해야할 점은 파이썬의 String에서 % 문자는  포맷팅을 지시하는데 쓰이므로 %문자 자체로
보여지게 하려면 %를 escape시켜줘야한다. 간단하게 %% 두번 쓰면 % 하나로 인식되게 된다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>Date,Open,High,Low,Close,Adj Close,Volume
</span></span><span style="display:flex;"><span>2019-10-31,8314.379883,8321.799805,8248.809570,8292.360352,8292.360352,2258270000
</span></span><span style="display:flex;"><span>2019-11-01,8335.049805,8386.750000,8326.559570,8386.400391,8386.400391,2057310000
</span></span><span style="display:flex;"><span>2019-11-04,8445.500000,8451.370117,8421.299805,8433.200195,8433.200195,2149910000
</span></span><span style="display:flex;"><span>2019-11-05,8446.620117,8457.389648,8421.049805,8434.679688,8434.679688,2316710000
</span></span><span style="display:flex;"><span>2019-11-06,8426.570313,8426.570313,8379.330078,8410.629883,8410.629883,2332650000
</span></span><span style="display:flex;"><span>2019-11-07,8455.110352,8483.160156,8415.870117,8434.519531,8434.519531,2393950000
</span></span><span style="display:flex;"><span>2019-11-08,8422.669922,8475.570313,8405.889648,8475.309570,8475.309570,1974190000
</span></span><span style="display:flex;"><span>2019-11-11,8431.259766,8467.290039,8425.480469,8464.280273,8464.280273,1715470000
</span></span><span style="display:flex;"><span>2019-11-12,8471.070313,8514.839844,8462.990234,8486.089844,8486.089844,1987820000
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>csv파일은 위와 같은 내용이 담겨진다.
일자는 Daily이다. 하지만 금융데이터이므로 주말이나 공휴일은 비어있게 된다.</p>
<h2 id="m2평탄화-하기">M2평탄화 하기</h2>
<p>두개의 데이터를 구했으므로 이론상 평탄화 한 값을 구할 수 있지만 몇가지 문제가 있다.</p>
<ol>
<li>M2는 1980년부터 시작, 지수는 2019년부터 시작</li>
<li>M2는 Weekly , 지수는 Daily 간격이 다름</li>
</ol>
<p>사실 위를 구하기 위해 늙은 프로그래머인 본인은 반복문을 짜고
M2의 일자들을 사용하여 Weekly 기준 지수 &lsquo;시고저종&rsquo;를 구하고 매핑해서
데이터를 구한 구식 프로그램을 짯다.
하지만 파이썬을 이용하면서 이렇게 구닥다리 노가다를 하는 것이 맞는지 의문이 들었고
조사결과 <a href="https://pandas.pydata.org/">Pandas</a>
라는 걸출한 라이브러리를 발견하게 되었다.</p>
<h3 id="데이터-merge">데이터 Merge</h3>
<p>Pandas는 정말 엄청나고 멋있고 위대한 라이브러리이다.
두개의 다른 데이터를  합쳐야 할 때 어떻게 할 것인가? 의문이 들었을때
늙은 프로그래머인 본인은 SQL에서 Left Outer Join 방식이 떠올랐다.
비슷한게 Pandas에 있다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>m2 <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>read_csv<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;M2.csv&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>m2<span style="color:#0550ae">.</span>columns <span style="color:#0550ae">=</span> <span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Date&#39;</span><span style="color:#1f2328">,</span> <span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ixic <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>read_csv<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;IXIC.csv&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># 일봉 기준으로 병합 </span>
</span></span><span style="display:flex;"><span>merged <span style="color:#0550ae">=</span> pd<span style="color:#0550ae">.</span>merge<span style="color:#1f2328">(</span>ixic<span style="color:#1f2328">,</span> m2<span style="color:#1f2328">,</span> on<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;Date&#39;</span><span style="color:#1f2328">,</span> how<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;left&#39;</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>그냥 직관적으로 merge를 하면 된다. 이때 기준점은 컬럼 Date이며
이를 위해 M2의 컬럼명을 IXIC의 컬럼명과 일치 시켰다.
그리고 how=left 를 통해 ixic 기준으로 m2가 합쳐지도록 했다.
ixic가 더 조밀한 데이터이므로 m2는 더 드물게 나타난다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>          Date         Open  ...     Volume       M2
</span></span><span style="display:flex;"><span>0   2019-09-23  8106.490234  ... 1780160000  15045.7
</span></span><span style="display:flex;"><span>1   2019-09-24  8147.229980  ... 2302600000      NaN
</span></span><span style="display:flex;"><span>2   2019-09-25  7990.660156  ... 2015270000      NaN
</span></span><span style="display:flex;"><span>3   2019-09-26  8070.120117  ... 1832800000      NaN
</span></span><span style="display:flex;"><span>4   2019-09-27  8047.109863  ... 2037720000      NaN
</span></span><span style="display:flex;"><span>5   2019-09-30  7964.089844  ... 1805820000  15086.4
</span></span><span style="display:flex;"><span>6   2019-10-01  8026.830078  ... 2243650000      NaN
</span></span><span style="display:flex;"><span>7   2019-10-02  7851.129883  ... 2495160000      NaN
</span></span><span style="display:flex;"><span>8   2019-10-03  7787.020020  ... 2141490000      NaN
</span></span><span style="display:flex;"><span>9   2019-10-04  7908.439941  ... 1736890000      NaN
</span></span><span style="display:flex;"><span>10  2019-10-07  7956.410156  ... 1739450000  15110.5
</span></span><span style="display:flex;"><span>11  2019-10-08  7898.270020  ... 1933580000      NaN
</span></span><span style="display:flex;"><span>12  2019-10-09  7895.959961  ... 1553900000      NaN
</span></span><span style="display:flex;"><span>13  2019-10-10  7904.560059  ... 1778740000      NaN
</span></span><span style="display:flex;"><span>14  2019-10-11  8047.339844  ... 2176080000      NaN
</span></span><span style="display:flex;"><span>15  2019-10-14  8044.350098  ... 1419730000  15116.9
</span></span><span style="display:flex;"><span>16  2019-10-15  8074.850098  ... 1836650000      NaN
</span></span><span style="display:flex;"><span>17  2019-10-16  8119.810059  ... 1886720000      NaN
</span></span><span style="display:flex;"><span>18  2019-10-17  8176.910156  ... 1861570000      NaN
</span></span><span style="display:flex;"><span>19  2019-10-18  8149.850098  ... 2012930000      NaN
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>결과는 위처럼 병합하여 나오게 된다. M2가 예상대로 중간중간 NaN으로 구멍이 나있는 것을 볼수 있다.</p>
<h3 id="interpolation">Interpolation</h3>
<p>M2가 중간 결측값이 있으므로 이를 채워주는 방법이 필요하다.
이를 보간처리 한다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#57606a"># 결측값은 Nan이므로 보간처리한다.</span>
</span></span><span style="display:flex;"><span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">]</span><span style="color:#0550ae">.</span>interpolate<span style="color:#1f2328">(</span>method<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;values&#39;</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>여기서 Pandas의 위대함이 드러난다. 단지 M2 &lsquo;열&rsquo;에 대해서 보간하라고 알려주었을 뿐이다.
이 라이브러리는 알아서 사이와 사이에 보간값을 채워준다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>          Date         Open ...     Volume        M2
</span></span><span style="display:flex;"><span>0   2019-09-23  8106.490234 ... 1780160000  15045.70
</span></span><span style="display:flex;"><span>1   2019-09-24  8147.229980 ... 2302600000  15053.84
</span></span><span style="display:flex;"><span>2   2019-09-25  7990.660156 ... 2015270000  15061.98
</span></span><span style="display:flex;"><span>3   2019-09-26  8070.120117 ... 1832800000  15070.12
</span></span><span style="display:flex;"><span>4   2019-09-27  8047.109863 ... 2037720000  15078.26
</span></span><span style="display:flex;"><span>5   2019-09-30  7964.089844 ... 1805820000  15086.40
</span></span><span style="display:flex;"><span>6   2019-10-01  8026.830078 ... 2243650000  15091.22
</span></span><span style="display:flex;"><span>7   2019-10-02  7851.129883 ... 2495160000  15096.04
</span></span><span style="display:flex;"><span>8   2019-10-03  7787.020020 ... 2141490000  15100.86
</span></span><span style="display:flex;"><span>9   2019-10-04  7908.439941 ... 1736890000  15105.68
</span></span><span style="display:flex;"><span>10  2019-10-07  7956.410156 ... 1739450000  15110.50
</span></span><span style="display:flex;"><span>11  2019-10-08  7898.270020 ... 1933580000  15111.78
</span></span><span style="display:flex;"><span>12  2019-10-09  7895.959961 ... 1553900000  15113.06
</span></span><span style="display:flex;"><span>13  2019-10-10  7904.560059 ... 1778740000  15114.34
</span></span><span style="display:flex;"><span>14  2019-10-11  8047.339844 ... 2176080000  15115.62
</span></span><span style="display:flex;"><span>15  2019-10-14  8044.350098 ... 1419730000  15116.90
</span></span><span style="display:flex;"><span>16  2019-10-15  8074.850098 ... 1836650000  15124.70
</span></span><span style="display:flex;"><span>17  2019-10-16  8119.810059 ... 1886720000  15132.50
</span></span><span style="display:flex;"><span>18  2019-10-17  8176.910156 ... 1861570000  15140.30
</span></span><span style="display:flex;"><span>19  2019-10-18  8149.850098 ... 2012930000  15148.10
</span></span></code></pre></div><p>중간값들이 채워진 것을 볼수 있다.</p>
<h3 id="새로운-열-구하기">새로운 열 구하기</h3>
<p>첫 행을 기준점으로 잡은 뒤에  현재의 M2값에서 기준점의 M2가
얼마의 비중을 차지하는지 계산 후 각 가격에 곱하여
영향도가 제거된 차트를 구한다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#57606a"># M2 Flatting </span>
</span></span><span style="display:flex;"><span>base_m2 <span style="color:#0550ae">=</span> merged<span style="color:#0550ae">.</span>loc<span style="color:#1f2328">[</span><span style="color:#0550ae">0</span><span style="color:#1f2328">][</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Open_1&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Open&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">*</span> base_m2 <span style="color:#0550ae">/</span> merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">])</span><span style="color:#0550ae">.</span>round<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;High_1&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;High&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">*</span> base_m2 <span style="color:#0550ae">/</span> merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">])</span><span style="color:#0550ae">.</span>round<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Low_1&#39;</span> <span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Low&#39;</span> <span style="color:#1f2328">]</span> <span style="color:#0550ae">*</span> base_m2 <span style="color:#0550ae">/</span> merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">])</span><span style="color:#0550ae">.</span>round<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Close_1&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Close&#39;</span><span style="color:#1f2328">]</span> <span style="color:#0550ae">*</span> base_m2 <span style="color:#0550ae">/</span> merged<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">])</span><span style="color:#0550ae">.</span>round<span style="color:#1f2328">(</span><span style="color:#0550ae">2</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>단지 dictionary에 key value 추가하는 것처럼 쉽게 된다.
실제로는 &lsquo;열&rsquo;이 추가가 되었으며 모든 행에 대해서 계산되게 된다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>          Date         Open         High          Low  ...   Open_1   High_1    Low_1  Close_1
</span></span><span style="display:flex;"><span>0   2019-09-23  8106.490234  8135.810059  8085.339844  ...  8106.49  8135.81  8085.34  8112.46     
</span></span><span style="display:flex;"><span>1   2019-09-24  8147.229980  8158.830078  7969.649902  ...  8142.82  8154.42  7965.34  7989.31     
</span></span><span style="display:flex;"><span>2   2019-09-25  7990.660156  8095.000000  7935.569824  ...  7982.02  8086.25  7926.99  8068.65     
</span></span><span style="display:flex;"><span>3   2019-09-26  8070.120117  8072.109863  7991.020020  ...  8057.04  8059.03  7978.07  8017.65     
</span></span><span style="display:flex;"><span>4   2019-09-27  8047.109863  8051.830078  7890.279785  ...  8029.73  8034.44  7873.24  7922.49     
</span></span><span style="display:flex;"><span>5   2019-09-30  7964.089844  8012.160156  7949.629883  ...  7942.60  7990.54  7928.18  7977.76     
</span></span><span style="display:flex;"><span>6   2019-10-01  8026.830078  8062.500000  7906.290039  ...  8002.62  8038.18  7882.44  7884.83     
</span></span><span style="display:flex;"><span>7   2019-10-02  7851.129883  7852.700195  7744.959961  ...  7824.95  7826.51  7719.13  7759.29     
</span></span><span style="display:flex;"><span>8   2019-10-03  7787.020020  7872.259766  7700.000000  ...  7758.58  7843.50  7671.87  7843.50     
</span></span><span style="display:flex;"><span>9   2019-10-04  7908.439941  7986.620117  7899.390137  ...  7877.04  7954.91  7868.02  7950.77     
</span></span><span style="display:flex;"><span>10  2019-10-07  7956.410156  8013.310059  7942.080078  ...  7922.29  7978.95  7908.02  7922.17     
</span></span><span style="display:flex;"><span>11  2019-10-08  7898.270020  7921.879883  7823.729980  ...  7863.73  7887.24  7789.52  7789.57     
</span></span><span style="display:flex;"><span>12  2019-10-09  7895.959961  7930.919922  7873.520020  ...  7860.77  7895.57  7838.43  7868.51     
</span></span><span style="display:flex;"><span>13  2019-10-10  7904.560059  7982.839844  7899.810059  ...  7868.66  7946.59  7863.93  7914.67     
</span></span><span style="display:flex;"><span>14  2019-10-11  8047.339844  8115.799805  8046.799805  ...  8010.12  8078.26  8009.58  8019.77     
</span></span><span style="display:flex;"><span>15  2019-10-14  8044.350098  8069.850098  8036.410156  ...  8006.46  8031.84  7998.56  8010.74     
</span></span><span style="display:flex;"><span>16  2019-10-15  8074.850098  8166.180176  8071.810059  ...  8032.67  8123.53  8029.65  8106.15     
</span></span><span style="display:flex;"><span>17  2019-10-16  8119.810059  8146.149902  8103.379883  ...  8073.23  8099.42  8056.90  8077.58     
</span></span><span style="display:flex;"><span>18  2019-10-17  8176.910156  8183.640137  8131.250000  ...  8125.82  8132.51  8080.44  8105.88     
</span></span><span style="display:flex;"><span>19  2019-10-18  8149.850098  8157.359863  8045.370117  ...  8094.76  8102.22  7990.98  8034.86  
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h2 id="차트-그리기">차트 그리기</h2>
<p>사실 데이터를 구하고 Pandas를 이용해 데이터를 가공하는 데까지는
30분도 안 걸려서 개발을 했었다. 하지만 이를 표현하는 차트를 그리는데
시간이 훨씬 더 걸렸다.
이것은 라이브러리 조사하고 사용방법을 공부해보고 내가 원하는 기능이 있는지 조사하고
없으면 다른것을 찾고 복잡하면 다른거 찾아보고..</p>
<p>결국 <a href="https://plotly.com/python/">Ploty</a> 라이브러리를 선택하여
차트를 그렸지만 사실 지금와서 생각해보면 <a href="https://github.com/tradingview/lightweight-charts">TradingView의 lightweight chart</a>
를 이용해서 그리는게 더 나을 것 같다는 생각이 든다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>tr1 <span style="color:#0550ae">=</span> go<span style="color:#0550ae">.</span>Candlestick<span style="color:#1f2328">(</span>x<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Date&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				<span style="color:#6639ba">open</span><span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Open_1&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				high<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;High_1&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				low<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Low_1&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				close<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Close_1&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;M2-Flat&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tr2 <span style="color:#0550ae">=</span> go<span style="color:#0550ae">.</span>Scatter<span style="color:#1f2328">(</span>x<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Date&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				y<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;M2&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>				yaxis<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;y2&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tr3 <span style="color:#0550ae">=</span> go<span style="color:#0550ae">.</span>Candlestick<span style="color:#1f2328">(</span>x<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Date&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				<span style="color:#6639ba">open</span><span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Open&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				high<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;High&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				low<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Low&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				close<span style="color:#0550ae">=</span>df<span style="color:#1f2328">[</span><span style="color:#0a3069">&#39;Close&#39;</span><span style="color:#1f2328">],</span>
</span></span><span style="display:flex;"><span>				name<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;original&#39;</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>				increasing_line_color<span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;gray&#39;</span><span style="color:#1f2328">,</span> decreasing_line_color<span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;magenta&#39;</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fig <span style="color:#0550ae">=</span> make_subplots<span style="color:#1f2328">(</span>specs<span style="color:#0550ae">=</span><span style="color:#1f2328">[[{</span><span style="color:#0a3069">&#39;secondary_y&#39;</span><span style="color:#1f2328">:</span> <span style="color:#cf222e">True</span><span style="color:#1f2328">}]])</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#0550ae">.</span>add_trace<span style="color:#1f2328">(</span>tr1<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#0550ae">.</span>add_trace<span style="color:#1f2328">(</span>tr2<span style="color:#1f2328">,</span> secondary_y<span style="color:#0550ae">=</span><span style="color:#cf222e">True</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#0550ae">.</span>add_trace<span style="color:#1f2328">(</span>tr3<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a">##</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#0550ae">.</span>update_layout<span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>	xaxis_rangeslider_visible<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>	title_text<span style="color:#0550ae">=</span><span style="color:#0a3069">&#39;IXIC-M2&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#0550ae">.</span>layout<span style="color:#0550ae">.</span>xaxis<span style="color:#0550ae">.</span>type <span style="color:#0550ae">=</span> <span style="color:#0a3069">&#39;category&#39;</span>
</span></span><span style="display:flex;"><span>fig<span style="color:#0550ae">.</span>write_html<span style="color:#1f2328">(</span><span style="color:#0a3069">&#39;IXIC_M2.html&#39;</span><span style="color:#1f2328">,</span> auto_open<span style="color:#0550ae">=</span><span style="color:#cf222e">False</span><span style="color:#1f2328">)</span>
</span></span></code></pre></div><p>굳이 차트라이브러리를 익힐 필요는 없는 것 같다. 필요할 때 가져다가 응용할수 있을 정도면 될것 같다.</p>
<h2 id="개인적-생각">개인적 생각</h2>
<p>위 모든 내용이 반영된 레포는
<a href="https://github.com/doongchoong/m2flat">doongchoong/m2flat</a>
이다.</p>
<p>완성된 차트를 보자.</p>
<p><img src="/img/m2_chart.PNG" alt="m2 chart"></p>
<p>빨간선은 M2 이고
보라색 캔들차트는 실제 지수차트,
녹색빨간색 캔들차트는 보정된 지수차트이다.</p>
<p>사실 이 프로그램을 만든 이유는
유동성 유입은 기본적으로 점진적인 상승을 이끈다는 생각 때문이였다.
하지만 M2를 평탄화 한 것은 그 생각에 대한 나의 주장일 뿐이고
뒷받침하는 근거가 되진 않는다.</p>
<p>사실 M2평탄화는 통화가치하락을 보정한 것이다.
코로나 충격이후 많은 돈이 유입되었고 그외 많은 노력으로 지수상승을 이끌어 냈는데
보정된 차트와 실제차트 사이에 사람들의 노력이 반영된 Real값 차트가 있을 것이다.</p>
<p>적어도 이런 지속적인 유동성 유입으로 하나는 알 수 있다.
&lsquo;시장을 역행하는 인버스 베팅은 불리한 게임&rsquo; 이라는 것이다.</p>

  </div>
  
  <a href="/" class="back-link">← Back to home</a>
</div>

    </div>
    
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  </body>
</html>
