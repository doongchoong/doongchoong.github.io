<!doctype html>
<html lang="ko-kr">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>íŒŒì´ì¬Tpsì¡°ì ˆ | ë‘¥ì¶©ì½”ë”©</title>
    <meta name="description" content="" />

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:wght@400;600&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

      
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>

    <style>

      @import url("https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400&display=swap");

      body {
        margin: 0;
        padding: 0;
         
        font:400 16px 'Noto Serif KR', serif;
        line-height: 1.6;
        color: #4a4b4f;
        background-color: #fbfbfb;
      }

      .container {
        max-width: 780px;  
        margin: 0 auto;
        padding: 20px 5px;
      }

      h1 {
        margin: 0 0 40px 0;
        color: #4a4b4f;
      }

      p {
        margin: 0 0 20px 0;
        line-height: 1.7;
      }

      a {
        color: #8f6a60;
        text-decoration: underline;
        text-decoration-thickness: 1px;
        text-underline-offset: 2px;
      }

      a:hover {
        color: #6b5046;
      }

      .section {
        margin-bottom: 40px;
      }

      .works-title {
        font-weight: 600;
        margin-bottom: 15px;
        color: #4a4b4f;
      }

      .work-item {
        margin-bottom: 12px;
        line-height: 1.6;
      }

      .work-link {
        display: block;
        text-decoration: none;
        color: #4a4b4f;
      }

      .work-link:hover {
        opacity: 0.8;
      }

      .work-title {
        font-weight: 500;
      }

      .publication {
        color: #8f6a60;
      }

      .year {
        color: #9d9d9d;
      }

      .description {
        color: #9d9d9d;
        font-style: italic;
        margin-top: 4px;
      }

      .contact {
        margin-top: 50px;
        padding-top: 30px;
        border-top: 1px solid #e5e5e5;
      }

      .footer-image {
        margin-top: 30px;
        text-align: left;
      }

      .footer-image img {
        width: 60px;
        height: auto;
        opacity: 0.7;
      }

      @media (max-width: 768px) {
        .container {
          padding: 40px 20px;
        }

        h1 {
          font-size: 22px;
        }

        body {
          font-size: 15px;
        }
      }
      
       
      pre {
        background-color: #f5f5f5;
        padding: 4px;
        border-radius: 4px;
        overflow-x: auto;
        margin: 0px 0;
      }
      
      code {
        font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        font-size: 14px;
        line-height: 1.5;
        text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
      }
      
      pre code {
        display: block;
        white-space: pre !important;
        word-wrap: normal !important;
        word-break: normal;
        overflow-x: auto;
      }
      
       
      p code, li code, h1 code, h2 code, h3 code {
        background-color: #f5f5f5;
        padding: 3px 5px;
        border-radius: 3px;
        font-size: 0.9em;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

       
      .post-content mjx-container[display="true"] {
        display: block;
        text-align: center;
        margin: 1em 0;
        overflow-x: auto !important;
        overflow-y: visible !important;
        max-width: 100% !important;
        width: 100% !important;
        box-sizing: border-box;
        padding-top: 1em;
        padding-bottom: 1em;
        min-height: unset;
      }
       
      .post-content mjx-container[display="true"] mjx-math {
        min-width: 0 !important;
        max-width: 100% !important;
        overflow-x: auto !important;
        overflow-y: visible !important;
        white-space: pre;
        box-sizing: border-box;
        min-height: unset;
      }
       
      .post-content {
        overflow-x: auto;
        overflow-y: visible;
      }
      
       
      .post-content img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        margin-top: 1.5em;
        margin-bottom: 1.5em;
      }
      
       
      .post-content img + em {
        display: block;
        text-align: center;
        font-size: 0.9em;
        color: #777;
        margin-top: -1em;
        margin-bottom: 1.5em;
      }

        .toc {
    border: thin solid ;
    padding: 1rem;
  }

    </style>

    <style>
 
.chatlog {
  font-family: 'Inter', 'Roboto', 'Noto Sans KR', sans-serif;
  font-size: 0.98rem;
  line-height: 1.75;
  color: #333;
  border: 1px solid ;
  border-radius: 10px;
  max-width: 580px;
  margin: 0 auto;
        padding: 20px 20px;
}

 
.chatlog table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5rem 0;
  font-size: 0.95rem;
}

.chatlog th,
.chatlog td {
  border: 1px solid #ddd;
  padding: 0.75rem;
  text-align: left;
}

.chatlog thead {
  background-color: #f0f0f5;
  font-weight: 600;
}

.chatlog tbody tr:nth-child(even) {
  background-color: #fafafa;
}

 
.chatlog pre {
  background-color: #f5f5f7;
  padding: 4px;
  overflow-x: auto;
  border-radius: 6px;
  font-size: 0.92rem;
  line-height: 1.6;
  margin: 4px;
}

.chatlog code {
  font-family: 'Courier New', monospace;
  color: #2c3e50;
}

 
.chatlog p code {
  background-color: #eef1f5;
  padding: 0.2rem 0.4rem;
  border-radius: 4px;
  font-size: 0.95em;
}
.user-bubble {
  background-color: #cdcdcd;
  border-radius: 16px 16px 0 16px;  
  padding: 0.8em 1.2em;
  margin: 0.5em 0 0.5em auto;  
  max-width: 80%;
  display: inline-block;
  position: relative;
}

.user-bubble::before {
  content: "";
  position: absolute;
  left: -10px;
  top: 10px;
  border: 6px solid transparent;
  border-right-color: #cdcdcd;
}

.gpt-line {
  margin: 0.5em 0;
}

.code-block-wrapper {
  margin: 1em 0;
}

.code-title {
  background: #f0f0f0;
  color: #555;
  font-size: 0.8rem;
  font-weight: bold;
  font-family: monospace;
  text-transform: uppercase;    
  padding: 4px 8px;
  border: 1px solid #ddd;
  border-bottom: none;
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;

  min-height: 1.5em;
}

.highlight_wrap {
  border: 1px solid #ddd;
  border-radius: 0 0 6px 6px;
  background: #fff;
}

.highlight {
  margin: 0;           
  padding: 4px 8px;    
}
    </style>
  </head>
  <body>
    <div class="container">
      
<style>
  .post-container {
    max-width: 780px;  
    margin: 0 auto;
    padding: 0 5px;
  }
  
  .post-header {
    margin-bottom: 40px;
  }
  
  .post-title {
    margin-bottom: 10px;
    color: #4a4b4f;
  }
  
  .post-date {
    color: #9d9d9d;
    font-style: italic;
    margin-bottom: 20px;
  }
  
  .post-description {
    font-style: italic;
    color: #666;
    margin-bottom: 30px;
    font-size: 17px;
  }
  
  .post-content {
    line-height: 1.8;
  }
  
  .post-content h2 {
    margin: 30px 0 20px 0;
    color: #4a4b4f;
  }
  
  .post-content p {
    margin-bottom: 20px;
  }
  
  .post-content img {
    display: block;
    width: 80%;
    max-width: 80%;
    height: auto;
    margin: 2rem auto;
    border-radius: 4px;
  }
  
   
  .post-content img + em {
    display: block;
    text-align: center;
    font-size: 0.9em;
    color: #777;
    margin-top: -0.5rem;
    margin-bottom: 2rem;
  }
  
  .post-content em {
    color: #666;
  }
  
  .back-link {
    display: inline-block;
    margin-top: 50px;
    margin-bottom: 30px;
    color: #8f6a60;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }
  
  .back-link:hover {
    color: #6b5046;
  }
</style>

<div class="post-container">
  <div class="post-header">
    <h1 class="post-title">íŒŒì´ì¬Tpsì¡°ì ˆ</h1>
    <div class="post-date">January 9, 2026</div>
  </div>
  
    
        <aside  class="toc" >
            <nav id="TableOfContents">
  <ul>
    <li><a href="#1-ê°€ì¥-ê¸°ë³¸-tps-ì¡°ì ˆ">1. ê°€ì¥ ê¸°ë³¸ tps ì¡°ì ˆ</a></li>
    <li><a href="#2-driftì œê±°-ë²„ì ¼">2. Driftì œê±° ë²„ì ¼</a></li>
    <li><a href="#3-ì •ë°€ë„ë¥¼-ë”-ë†’ì¸-ë²„ì ¼">3. ì •ë°€ë„ë¥¼ ë” ë†’ì¸ ë²„ì ¼</a></li>
    <li><a href="#4-adaptive-tps">4. Adaptive TPS</a></li>
    <li><a href="#5-ìƒê°">5. ìƒê°</a></li>
  </ul>
</nav>
        </aside>
    

  <div class="post-content">
    <p>íšŒì‚¬ì—ì„œ íŒŒì´ì¬ì„ ì—¬ëŸ¬ê°€ì§€ ìš©ë„ë¡œ í™œìš©í•˜ê³  ìˆëŠ”ë°
ëŒ€ê·œëª¨ ë¶€í•˜í…ŒìŠ¤íŠ¸ ì „ ì‹¤í—˜ì ìœ¼ë¡œ ëŒë ¤ë³´ëŠ” ìš©ë„ë¡œë„ ì‚¬ìš©í•œë‹¤.
ì¢€ë” ê³ ë„í™”í•´ì„œ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ê³¼ì •ì„ ê¸°ë¡í•œë‹¤.</p>
<h2 id="1-ê°€ì¥-ê¸°ë³¸-tps-ì¡°ì ˆ">1. ê°€ì¥ ê¸°ë³¸ tps ì¡°ì ˆ</h2>
<div class="code-block-wrapper">
  <div class="code-title">PY</div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">tps_test</span><span style="color:#1f2328">(</span>tps<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    interval <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.0</span> <span style="color:#0550ae">/</span> tps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> i <span style="color:#0550ae">in</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span><span style="color:#0550ae">5000</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        _call_my_job<span style="color:#1f2328">(</span>i<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        time<span style="color:#0550ae">.</span>sleep<span style="color:#1f2328">(</span>interval<span style="color:#1f2328">)</span></span></span></code></pre></div>
  </div>
</div><p>1ì´ˆ ê¸°ì¤€ìœ¼ë¡œ ì—­ì‚°í•˜ì—¬ sleepí•  ì‹œê°„ì„ êµ¬í•œë‹¤.
í•˜ì§€ë§Œ ì´ë ‡ê²Œ ë§Œë“¤ë©´ drifting
ì¦‰ í•¨ìˆ˜í˜¸ì¶œì´ë‚˜ ì‹œìŠ¤í…œ ì½œë“±ì´ ëˆ„ì ë˜ë©° ì¡°ê¸ˆì”©ì˜ ì˜¤ì°¨ê°€ ëˆ„ì ëœë‹¤.</p>
<h2 id="2-driftì œê±°-ë²„ì ¼">2. Driftì œê±° ë²„ì ¼</h2>
<p>ì œë„¤ë ˆì´í„°ë¡œ ë°”ê¾¼ë‹¤. ê¸°ë³¸ê°œë…ì€ ê¸°ë³¸ ì¸í„°ë²Œì´ ì ìš©ëœ ë‹¤ìŒ &lsquo;ê¸°ëŒ€&rsquo;ì‹œê°„ê³¼ í˜„ì¬ ì‹œê°„ì˜ ì°¨ì´ë§Œí¼
sleepí•˜ëŠ” ê²ƒ.</p>
<p>ëŒ€ì‹  ì–‘ìˆ˜ì¼ë•Œ sleepí•˜ê³  ìŒìˆ˜ë¼ë©´ (ì´ë¯¸ &lsquo;ê¸°ëŒ€&rsquo;ì‹œê°„ì´ ì§€ë‚œ ìƒí™©) ì¦‰ê° í˜¸ì¶œí•œë‹¤.</p>
<div class="code-block-wrapper">
  <div class="code-title">PY</div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">time</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">itertools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">tps_throttle</span><span style="color:#1f2328">(</span>iterable<span style="color:#1f2328">,</span> tps<span style="color:#1f2328">,</span> total<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    interval <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.0</span> <span style="color:#0550ae">/</span> tps
</span></span><span style="display:flex;"><span>    it <span style="color:#0550ae">=</span> itertools<span style="color:#0550ae">.</span>cycle<span style="color:#1f2328">(</span>iterable<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    next_tick <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> _ <span style="color:#0550ae">in</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span>total<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        now <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>        sleep_time <span style="color:#0550ae">=</span> next_tick <span style="color:#0550ae">-</span> now
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> sleep_time <span style="color:#0550ae">&gt;</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            time<span style="color:#0550ae">.</span>sleep<span style="color:#1f2328">(</span>sleep_time<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">yield</span> <span style="color:#6639ba">next</span><span style="color:#1f2328">(</span>it<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        next_tick <span style="color:#0550ae">+=</span> interval
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#57606a"># ì œë„¤ë ˆì´í„° ì‚¬ìš©</span>
</span></span><span style="display:flex;"><span>dat <span style="color:#0550ae">=</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span><span style="color:#0550ae">1000</span><span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">for</span> itm <span style="color:#0550ae">in</span> <span style="color:#1f2328">(</span>dat<span style="color:#1f2328">,</span> tps<span style="color:#0550ae">=</span><span style="color:#0550ae">200</span><span style="color:#1f2328">,</span> total<span style="color:#0550ae">=</span><span style="color:#0550ae">100000</span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    _call_my_job<span style="color:#1f2328">(</span>itm<span style="color:#1f2328">)</span></span></span></code></pre></div>
  </div>
</div><p>ì œë„¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•œ forë¬¸ì€ tpsê°€ ì¡°ì •ë˜ì„œ ì •í™•í•˜ê²Œ í˜¸ì¶œëœë‹¤.
ì—¬ê¸°ê¹Œì§€ëŠ” ë‚´ê°€ ì‘ì„±í•˜ì—¬ ì‚¬ìš©í–ˆë˜ ë²„ì ¼ì¸ë°
ì´ì œ ë” ì •í™•í•œ tpsë¥¼ ë§Œë“¤ìˆ˜ ìˆë‚˜? ë¼ëŠ” ê¶ê¸ˆì¦ì´ ìƒê²¼ë‹¤.</p>
<h2 id="3-ì •ë°€ë„ë¥¼-ë”-ë†’ì¸-ë²„ì ¼">3. ì •ë°€ë„ë¥¼ ë” ë†’ì¸ ë²„ì ¼</h2>
<p>ì¼ë‹¨ GPTì—ê²Œ í•œë²ˆ ë¬¼ì–´ë³´ì•˜ë‹¤.</p>








<div class="chatlog">
  <p><div class="user-bubble"><strong>User</strong>. êµ‰ì¥íˆ ë¯¸ì„¸í•œ êµ¬ê°„ì—ì„œ ì•½ê°„ ì¼ì° sleepì„ ëë‚´ê³  busy-waitingí•´ë„ ë˜ë‚˜?</div></p>
<p><strong>ğŸ¤– ChatGPT:</strong><br>
ì§§ì€ ë‹µë¶€í„° ë§í•˜ë©´ **â€œëœë‹¤, ê·¸ë¦¬ê³  ê·¸ê²Œ ì •ì„ì´ë‹¤â€**ì•¼.
ë‹¤ë§Œ <strong>ì–´ë””ê¹Œì§€ í—ˆìš©í•˜ëŠëƒ</strong>ê°€ ì¤‘ìš”í•´.</p>
<hr>
<h2 id="ê²°ë¡ -í•œ-ì¤„">ê²°ë¡  í•œ ì¤„</h2>
<blockquote>
<p><strong>ì•„ì£¼ ë¯¸ì„¸í•œ êµ¬ê°„(ìˆ˜ë°± Î¼s ì´í•˜)ì—ì„œë§Œ sleepì„ ì¼ì° ê¹¨ê³  busy-wait í•˜ëŠ” ê±´
ì •í™•ë„ë¥¼ ì˜¬ë¦¬ëŠ” ì˜¬ë°”ë¥¸ ë°©ë²•ì´ë‹¤.</strong></p></blockquote>
<p>ì´ê±´ â€œí¸ë²•â€ì´ ì•„ë‹ˆë¼ <strong>íƒ€ì´ë¨¸ ì •í™•ë„ ë³´ì • ê¸°ë²•</strong>ì´ì•¼.</p>
<hr>
<h2 id="ì™œ-ì´ëŸ°-ê²Œ-í•„ìš”í•˜ëƒë©´">ì™œ ì´ëŸ° ê²Œ í•„ìš”í•˜ëƒë©´</h2>
<h3 id="timesleepì˜-í˜„ì‹¤"><code>time.sleep()</code>ì˜ í˜„ì‹¤</h3>
<ul>
<li>
<p><code>sleep(0.002)</code> â†’ <strong>ì •í™•íˆ 2ms ë³´ì¥ âŒ</strong></p>
</li>
<li>
<p>ì‹¤ì œë¡œëŠ”:</p>
<ul>
<li>2.1ms</li>
<li>2.8ms</li>
<li>ê°€ë” 4ms</li>
</ul>
</li>
</ul>
<p>ì¦‰, <strong>sleepì€ í•­ìƒ ëŠ¦ê²Œ ê¹¬ë‹¤</strong>
â†’ TPSì—ì„œëŠ” ì´ â€œëŠ¦ìŒâ€ì´ ë¬¸ì œ</p>
<hr>
<h2 id="ê·¸ë˜ì„œ-ì“°ëŠ”-íŒ¨í„´ì´-ì´ê±°ì•¼">ê·¸ë˜ì„œ ì“°ëŠ” íŒ¨í„´ì´ ì´ê±°ì•¼</h2>
<h3 id="ê°œë…">ê°œë…</h3>
<ol>
<li><strong>ë©€ë¦¬ ìˆì„ ë•Œ</strong> â†’ sleep</li>
<li><strong>ì•„ì£¼ ê°€ê¹Œì›Œì§€ë©´</strong> â†’ busy-wait</li>
</ol>
<hr>
<h2 id="ì •ì„-êµ¬ì¡°-500-tpsì—-ë”±-ë§ìŒ">ì •ì„ êµ¬ì¡° (500 TPSì— ë”± ë§ìŒ)</h2>
<div class="code-block-wrapper">
  <div class="code-title">PYTHON</div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">time</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">itertools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">tps_throttle</span><span style="color:#1f2328">(</span>iterable<span style="color:#1f2328">,</span> tps<span style="color:#1f2328">,</span> total<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    interval <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.0</span> <span style="color:#0550ae">/</span> tps
</span></span><span style="display:flex;"><span>    it <span style="color:#0550ae">=</span> itertools<span style="color:#0550ae">.</span>cycle<span style="color:#1f2328">(</span>iterable<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SPIN_THRESHOLD <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.0005</span>  <span style="color:#57606a"># 0.5ms</span>
</span></span><span style="display:flex;"><span>    next_tick <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> _ <span style="color:#0550ae">in</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span>total<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">while</span> <span style="color:#cf222e">True</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            now <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            remaining <span style="color:#0550ae">=</span> next_tick <span style="color:#0550ae">-</span> now
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> remaining <span style="color:#0550ae">&lt;=</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">break</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> remaining <span style="color:#0550ae">&gt;</span> SPIN_THRESHOLD<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                time<span style="color:#0550ae">.</span>sleep<span style="color:#1f2328">(</span>remaining <span style="color:#0550ae">-</span> SPIN_THRESHOLD<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#57606a"># ë§ˆì§€ë§‰ ìˆ˜ë°± Î¼së§Œ spin</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">yield</span> <span style="color:#6639ba">next</span><span style="color:#1f2328">(</span>it<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        next_tick <span style="color:#0550ae">+=</span> interval</span></span></code></pre></div>
  </div>
</div><h2 id="ì–´ëŠ-ì •ë„ê°€-ì•ˆì „í•œ-spin-êµ¬ê°„ì¸ê°€">ì–´ëŠ ì •ë„ê°€ â€œì•ˆì „í•œâ€ spin êµ¬ê°„ì¸ê°€?</h2>
<p>ì‹¤ë¬´ ê¸°ì¤€ í‘œë¡œ ì¤„ê²Œ.</p>
<table>
  <thead>
      <tr>
          <th>í™˜ê²½</th>
          <th>SPIN_THRESHOLD</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>macOS / Linux</td>
          <td>0.3 ~ 0.7 ms</td>
      </tr>
      <tr>
          <td>Windows</td>
          <td>0.8 ~ 1.5 ms</td>
      </tr>
      <tr>
          <td>ì„œë²„ (ì „ìš© ì½”ì–´)</td>
          <td>0.1 ~ 0.3 ms</td>
      </tr>
  </tbody>
</table>
<p>ğŸ‘‰ ì²˜ìŒì—” <strong>0.5ms</strong>ë¡œ ë‘ê³  ì¸¡ì •í•˜ëŠ” ê²Œ ë² ìŠ¤íŠ¸</p>

</div>
<p>ê·¸ë˜ ë„ˆë¬´ ì¢‹ë‹¤. thresholdê°€ ì›Œë‚™ ì‘ì€ ê°’ì´ë¼ spinì€ êµ‰ì¥íˆ ì§§ê²Œ ëŒê²Œ ëœë‹¤.
êµ‰ì¥íˆ ì •í™•í•œ íƒ€ì´ë°ìœ¼ë¡œ tpsê°€ ìª¼ê°œì ¸ í˜¸ì¶œë  ê²ƒì´ë‹¤.</p>
<h2 id="4-adaptive-tps">4. Adaptive TPS</h2>
<p>ë¬¸ë“ ì´ëŸ°ìƒê°ì´ ë“¤ì—ˆë‹¤. sync ë°©ì‹ ì½œë§í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì¸¡ì •í•˜ë©´ ê¸°ëŒ€í•˜ëŠ” tpsë¥¼ ë†’ê²Œ ì ì–´ë„
ì‹¤ì§ˆ tpsê°€ êµ‰ì¥íˆ ëŠë¦´í…ë°. ì´ëŸ° ê²½ìš° ë™ì ìœ¼ë¡œ tpsê°€ ì¤„ì–´ë“¤ì–´ ì ì ˆí•œ tpsë¡œ ë³€í™”í•˜ëŠ” ë°©ë²•ì€ ì—†ì„ê¹Œ ìƒê°í–ˆë‹¤.
ë¬¼ë¡  async ì½œë§ê°™ì´ êµ‰ì¥íˆ ë¹ ë¥¸ ì¼€ì´ìŠ¤ëŠ” ê·¸ëŒ€ë¡œ ê¸°ëŒ€tpsë¥¼ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤.</p>








<div class="chatlog">
  <p><div class="user-bubble"><strong>User</strong>. ëŒ€ë¶€ë¶„ tps_throttleì„ ì“°ëŠ” ëŒ€ìƒì€ asyncë¡œ ì‹œìŠ¤í…œì½œë§Œ í•˜ëŠ” ê±°ë¼ì„œ ë¹ ë¥¸ë°, ê°„í˜¹ ë‚´ê°€ ì•„ë‹Œ ë‹¤ë¥¸ì‚¬ëŒì´ blocking ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí• ìˆ˜ë„ ìˆì–´ ê·¸ëŸ¬ë©´ ê¸°ëŒ€í•˜ëŠ” tpsë³´ë‹¤ í›¨ì”¬ ë‚®ì€ ì‹¤ì œ tpsê°€ ë‚˜ì˜¬í…ë° ì´ëŸ° ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ì„œ adaptiveí•˜ê²Œ ì¡°ì ˆ í•˜ëŠ” ë°©ë²•ì´ ìˆì„ê¹Œ?</div></p>
<p><strong>ğŸ¤– ChatGPT:</strong><br>
ì´ê±´ <strong>â€œTPS ë°œìƒê¸° + ëŠë¦° ì†Œë¹„ìâ€ê°€ ì„ì¼ ë•Œ ë°˜ë“œì‹œ ìƒê¸°ëŠ” ë¬¸ì œ</strong>ê³ ,
í•´ê²°ì±…ì€ <strong>íƒ€ì´ë° ê¸°ë²•ì´ ì•„ë‹ˆë¼ â€œì œì–´(ì»¨íŠ¸ë¡¤)â€ ë¬¸ì œ</strong>ì•¼.</p>
<p>ê²°ë¡ ë¶€í„° ë§í•˜ë©´:</p>
<blockquote>
<p><strong>ê°€ëŠ¥í•˜ë‹¤.</strong>
ë‹¤ë§Œ <strong>â€œTPSë¥¼ ë³´ì¥â€í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼
â€œì‹œìŠ¤í…œì´ ê°ë‹¹ ê°€ëŠ¥í•œ TPSë¡œ ìë™ ìˆ˜ë ´â€</strong> í•˜ê²Œ ë§Œë“œëŠ” ë°©ì‹ì´ë‹¤.</p></blockquote>
<hr>
<h3 id="-í˜„ì‹¤ì ì¸-ëª©í‘œ">âœ… í˜„ì‹¤ì ì¸ ëª©í‘œ</h3>
<blockquote>
<p>â€œì‹œìŠ¤í…œì´ ë§‰íˆë©´ TPSë¥¼ ë‚®ì¶”ë˜,
íšŒë³µë˜ë©´ ë‹¤ì‹œ ì˜¬ë¦¬ìâ€</p></blockquote>
<p>ì´ê²Œ ë°”ë¡œ <strong>Adaptive Throttling</strong></p>
<h3 id="aimd-additive-increase--multiplicative-decrease">AIMD (Additive Increase / Multiplicative Decrease)</h3>
<p>TCP í˜¼ì¡ì œì–´ë‘ ê°™ì€ ë°©ì‹ì´ì•¼.</p>
<ul>
<li>ì˜ ëŒì•„ê°€ë©´ â†’ TPS <strong>ì²œì²œíˆ ì¦ê°€</strong></li>
<li>ë§‰íˆë©´ â†’ TPS <strong>í™• ì¤„ì„</strong></li>
</ul>
<hr>
<h2 id="ìµœì†Œí•œì˜-adaptive-tps_throttle-êµ¬í˜„">ìµœì†Œí•œì˜ Adaptive tps_throttle êµ¬í˜„</h2>
<h3 id="í•µì‹¬-ì•„ì´ë””ì–´">í•µì‹¬ ì•„ì´ë””ì–´</h3>
<ul>
<li>ëª©í‘œ TPSëŠ” <code>target_tps</code></li>
<li>ì‹¤ì œ TPSëŠ” <code>current_tps</code></li>
<li>consumerê°€ ëŠë ¤ì§€ë©´ <code>current_tps â†“</code></li>
</ul>
<div class="code-block-wrapper">
  <div class="code-title">PY</div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#0550ae">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- latency ê´€ì¸¡ ---</span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">if</span> last_yield <span style="color:#0550ae">is</span> <span style="color:#0550ae">not</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>        actual_interval <span style="color:#0550ae">=</span> t <span style="color:#0550ae">-</span> last_yield
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># ê¸°ëŒ€ë³´ë‹¤ ëŠë¦¬ë©´ ê³¼ë¶€í•˜ íŒë‹¨</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> actual_interval <span style="color:#0550ae">&gt;</span> interval <span style="color:#0550ae">*</span> <span style="color:#0550ae">1.5</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            current_tps <span style="color:#0550ae">*=</span> <span style="color:#0550ae">0.7</span>   <span style="color:#57606a"># multiplicative decrease</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            current_tps <span style="color:#0550ae">+=</span> <span style="color:#0550ae">1</span>     <span style="color:#57606a"># additive increase</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        current_tps <span style="color:#0550ae">=</span> <span style="color:#6639ba">max</span><span style="color:#1f2328">(</span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">min</span><span style="color:#1f2328">(</span>current_tps<span style="color:#1f2328">,</span> target_tps<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>        interval <span style="color:#0550ae">=</span> <span style="color:#0550ae">1</span> <span style="color:#0550ae">/</span> current_tps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    last_yield <span style="color:#0550ae">=</span> t
</span></span><span style="display:flex;"><span>    next_tick <span style="color:#0550ae">+=</span> interval</span></span></code></pre></div>
  </div>
</div><p><div class="user-bubble"><strong>User</strong>. íšŒë³µì„ ê³„ì† í•˜ë‚˜? tpsë¥¼ ì¡°ê¸ˆì”© ì˜¬ë¦¬ë‹¤ê°€ 1.5ë°° ë„˜ìœ¼ë©´ ê°‘ìê¸° 70% ê°ì‡ ë˜ì–ì•„ ìˆ˜ë ´í•˜ê²Œ í•´ì•¼ì§€</div></p>
<p><strong>ğŸ¤– ChatGPT:</strong><br>
ë§ì•„. <strong>ì§€ê¸ˆ êµ¬ì¡° ê·¸ëŒ€ë¡œë©´ â€œì™”ë‹¤ ê°”ë‹¤(oscillation)â€ í•  ìˆ˜ ìˆì–´.</strong>
ë„¤ê°€ ì •í™•íˆ ì§šì€ í¬ì¸íŠ¸ëŠ” <strong>ì œì–´ ì´ë¡  ë¬¸ì œ</strong>ê³ , í•´ê²° í‚¤ì›Œë“œëŠ” ë”± ë‘ ê°œì•¼:</p>
<blockquote>
<p><strong>â‘  ë…¸ì´ì¦ˆ ì œê±°(í‰í™œí™”)</strong>
<strong>â‘¡ ìˆ˜ë ´ ì¡°ê±´ ëª…ì‹œ</strong></p></blockquote>
<p>ì•„ë˜ë¥¼ ìˆœì„œëŒ€ë¡œ ë³´ë©´ â€œì™œ í”ë“¤ë¦¬ê³  â†’ ì–´ë–»ê²Œ ìˆ˜ë ´ì‹œí‚¤ëŠ”ì§€â€ê°€ í•œ ë²ˆì— ë³´ì¼ ê±°ì•¼.</p>
<hr>
<h2 id="1-ì™œ-ì§€ê¸ˆ-ë¡œì§ì€-í”ë“¤ë¦¬ë‚˜-ë¬¸ì œì˜-ë³¸ì§ˆ">1ï¸âƒ£ ì™œ ì§€ê¸ˆ ë¡œì§ì€ í”ë“¤ë¦¬ë‚˜ (ë¬¸ì œì˜ ë³¸ì§ˆ)</h2>
<p>í˜„ì¬ ë¡œì§ ìš”ì•½í•˜ë©´:</p>
<ul>
<li>ì •ìƒ â†’ TPS +1</li>
<li>ëŠë¦¼ ê°ì§€ â†’ TPS Ã— 0.7</li>
</ul>
<p>ì´ê±´ ì „í˜•ì ì¸ <strong>ê±°ì¹œ AIMD</strong>ì•¼.</p>
<p>ë¬¸ì œëŠ”:</p>
<ul>
<li>latencyëŠ” <strong>í•­ìƒ ë…¸ì´ì¦ˆê°€ ìˆìŒ</strong></li>
<li>ë‹¨ë°œì„± blockingì—ë„ ì¦‰ì‹œ Ã—0.7</li>
<li>íšŒë³µì€ ì„ í˜•, ê°ì‡ ëŠ” ê¸‰ê²©</li>
</ul>
<p>ê²°ê³¼:</p>
<div class="code-block-wrapper">
  <div class="code-title"></div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ì˜¬ë¼ê° â†’ í•œë²ˆ íŠ â†’ ê¸‰ë½ â†’ ë‹¤ì‹œ ì˜¬ë¼ê° â†’ ë˜ íŠ â€¦</span></span></code></pre></div>
  </div>
</div><p>ğŸ‘‰ <strong>ìˆ˜ë ´ì  ê·¼ì²˜ì—ì„œ ê³„ì† ì§„ë™</strong></p>
<hr>
<h2 id="2-ìˆ˜ë ´ì„-ë§Œë“¤ë ¤ë©´-ë°˜ë“œì‹œ-í•„ìš”í•œ-2ê°€ì§€">2ï¸âƒ£ ìˆ˜ë ´ì„ ë§Œë“¤ë ¤ë©´ ë°˜ë“œì‹œ í•„ìš”í•œ 2ê°€ì§€</h2>
<h3 id="-a-ê´€ì¸¡ê°’ì„-í‰í™œí™”í•´ì•¼-í•œë‹¤-ewma">âœ… (A) ê´€ì¸¡ê°’ì„ í‰í™œí™”í•´ì•¼ í•œë‹¤ (EWMA)</h3>
<p>ë‹¨ì¼ ìƒ˜í”Œë¡œ íŒë‹¨ âŒ
<strong>ì´ë™ í‰ê· </strong>ìœ¼ë¡œ íŒë‹¨ âœ…</p>
<div class="code-block-wrapper">
  <div class="code-title">PYTHON</div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ewma <span style="color:#0550ae">=</span> Î± <span style="color:#0550ae">*</span> sample <span style="color:#0550ae">+</span> <span style="color:#1f2328">(</span><span style="color:#0550ae">1</span><span style="color:#0550ae">-</span>Î±<span style="color:#1f2328">)</span> <span style="color:#0550ae">*</span> ewma</span></span></code></pre></div>
  </div>
</div><ul>
<li>Î± = 0.1 ~ 0.3 (ë³´í†µ)</li>
<li>blocking â€œíŒ¨í„´â€ë§Œ ë°˜ì‘</li>
<li>ìŠ¤íŒŒì´í¬ ë¬´ì‹œ</li>
</ul>
<hr>
<h2 id="3-ìˆ˜ë ´í˜•-adaptive-ì œì–´ì˜-ì •ì„-êµ¬ì¡°">3ï¸âƒ£ ìˆ˜ë ´í˜• Adaptive ì œì–´ì˜ ì •ì„ êµ¬ì¡°</h2>
<p>ê°œë…ì ìœ¼ë¡œ ì´ë ‡ê²Œ ëœë‹¤:</p>
<div class="code-block-wrapper">
  <div class="code-title"></div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>measured_interval (EWMA)
</span></span><span style="display:flex;"><span>        â†“
</span></span><span style="display:flex;"><span>error = measured - target
</span></span><span style="display:flex;"><span>        â†“
</span></span><span style="display:flex;"><span>ì‘ì€ ì˜¤ì°¨ â†’ ìœ ì§€
</span></span><span style="display:flex;"><span>í° ì˜¤ì°¨ ì§€ì† â†’ ê°ì†Œ
</span></span><span style="display:flex;"><span>ì˜¤ì°¨ ê±°ì˜ ì—†ìŒ ì§€ì† â†’ ì¦ê°€</span></span></code></pre></div>
  </div>
</div><p>ì´ê±´ ì‚¬ì‹¤ìƒ <strong>1ì°¨ PI ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë‹¨ìˆœí˜•</strong>ì´ì•¼.</p>
<hr>
<h2 id="4-ë„¤-throttleì—-ë§ëŠ”-ìˆ˜ë ´í˜•-ë¡œì§-ì‹¤ì „ìš©">4ï¸âƒ£ ë„¤ throttleì— ë§ëŠ” â€œìˆ˜ë ´í˜•â€ ë¡œì§ (ì‹¤ì „ìš©)</h2>
<h3 id="í•µì‹¬-ì •ì±…">í•µì‹¬ ì •ì±…</h3>
<ul>
<li>ê¸°ì¤€: <code>measured_interval / ideal_interval</code></li>
<li>EWMAë¡œ íŒë‹¨</li>
<li>dead-zone(ë¬´ë°˜ì‘ êµ¬ê°„) ì¡´ì¬</li>
<li>ë³€í™”ëŸ‰ ì œí•œ</li>
</ul>
<hr>
<h3 id="-ìˆ˜ë ´í˜•-adaptive--spin-ìµœì¢…-ì˜ˆì œ">â­ ìˆ˜ë ´í˜• adaptive + spin ìµœì¢… ì˜ˆì œ</h3>
<div class="code-block-wrapper">
  <div class="code-title">PYTHON</div>
  <div class="highlight_wrap">
    <div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">time</span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">import</span> <span style="color:#24292e">itertools</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#cf222e">def</span> <span style="color:#6639ba">adaptive_tps_throttle</span><span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>    iterable<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    target_tps<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    total<span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span>    spin_threshold<span style="color:#0550ae">=</span><span style="color:#0550ae">0.0005</span><span style="color:#1f2328">,</span>
</span></span><span style="display:flex;"><span><span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>    it <span style="color:#0550ae">=</span> itertools<span style="color:#0550ae">.</span>cycle<span style="color:#1f2328">(</span>iterable<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    current_tps <span style="color:#0550ae">=</span> target_tps
</span></span><span style="display:flex;"><span>    interval <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.0</span> <span style="color:#0550ae">/</span> current_tps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    next_tick <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>    last_yield <span style="color:#0550ae">=</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#57606a"># --- control parameters ---</span>
</span></span><span style="display:flex;"><span>    ewma_interval <span style="color:#0550ae">=</span> <span style="color:#cf222e">None</span>
</span></span><span style="display:flex;"><span>    ALPHA <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.2</span>          <span style="color:#57606a"># smoothing</span>
</span></span><span style="display:flex;"><span>    DEADZONE <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.1</span>       <span style="color:#57606a"># Â±10%ëŠ” ë¬´ì‹œ</span>
</span></span><span style="display:flex;"><span>    DEC_RATE <span style="color:#0550ae">=</span> <span style="color:#0550ae">0.9</span>       <span style="color:#57606a"># ê°ì†Œ ì‹œ 10%</span>
</span></span><span style="display:flex;"><span>    INC_STEP <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.0</span>       <span style="color:#57606a"># ì¦ê°€ ì‹œ +1 tps</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#cf222e">for</span> _ <span style="color:#0550ae">in</span> <span style="color:#6639ba">range</span><span style="color:#1f2328">(</span>total<span style="color:#1f2328">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- precise wait ---</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">while</span> <span style="color:#cf222e">True</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            now <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>            remaining <span style="color:#0550ae">=</span> next_tick <span style="color:#0550ae">-</span> now
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> remaining <span style="color:#0550ae">&lt;=</span> <span style="color:#0550ae">0</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                <span style="color:#cf222e">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> remaining <span style="color:#0550ae">&gt;</span> spin_threshold<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                time<span style="color:#0550ae">.</span>sleep<span style="color:#1f2328">(</span>remaining <span style="color:#0550ae">-</span> spin_threshold<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">yield</span> <span style="color:#6639ba">next</span><span style="color:#1f2328">(</span>it<span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>        now <span style="color:#0550ae">=</span> time<span style="color:#0550ae">.</span>perf_counter<span style="color:#1f2328">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#57606a"># --- measure ---</span>
</span></span><span style="display:flex;"><span>        <span style="color:#cf222e">if</span> last_yield <span style="color:#0550ae">is</span> <span style="color:#0550ae">not</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>            measured <span style="color:#0550ae">=</span> now <span style="color:#0550ae">-</span> last_yield
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> ewma_interval <span style="color:#0550ae">is</span> <span style="color:#cf222e">None</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                ewma_interval <span style="color:#0550ae">=</span> measured
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">else</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                ewma_interval <span style="color:#0550ae">=</span> <span style="color:#1f2328">(</span>
</span></span><span style="display:flex;"><span>                    ALPHA <span style="color:#0550ae">*</span> measured <span style="color:#0550ae">+</span> <span style="color:#1f2328">(</span><span style="color:#0550ae">1</span> <span style="color:#0550ae">-</span> ALPHA<span style="color:#1f2328">)</span> <span style="color:#0550ae">*</span> ewma_interval
</span></span><span style="display:flex;"><span>                <span style="color:#1f2328">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            ratio <span style="color:#0550ae">=</span> ewma_interval <span style="color:#0550ae">/</span> interval
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#57606a"># --- adaptive control (ìˆ˜ë ´ í•µì‹¬) ---</span>
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">if</span> ratio <span style="color:#0550ae">&gt;</span> DEADZONE<span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                current_tps <span style="color:#0550ae">*=</span> DEC_RATE
</span></span><span style="display:flex;"><span>            <span style="color:#cf222e">elif</span> ratio <span style="color:#0550ae">&lt;</span> <span style="color:#0550ae">0.95</span><span style="color:#1f2328">:</span>
</span></span><span style="display:flex;"><span>                current_tps <span style="color:#0550ae">+=</span> INC_STEP
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            current_tps <span style="color:#0550ae">=</span> <span style="color:#6639ba">max</span><span style="color:#1f2328">(</span><span style="color:#0550ae">1</span><span style="color:#1f2328">,</span> <span style="color:#6639ba">min</span><span style="color:#1f2328">(</span>current_tps<span style="color:#1f2328">,</span> target_tps<span style="color:#1f2328">))</span>
</span></span><span style="display:flex;"><span>            interval <span style="color:#0550ae">=</span> <span style="color:#0550ae">1.0</span> <span style="color:#0550ae">/</span> current_tps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        last_yield <span style="color:#0550ae">=</span> now
</span></span><span style="display:flex;"><span>        next_tick <span style="color:#0550ae">+=</span> interval</span></span></code></pre></div>
  </div>
</div>
</div>
<p>ì´ë ‡ê²Œ í•˜ë©´ ê¸°ì¡´ì— async ì½œë§í•˜ëŠ” ê²½ìš° 500tpsì— ìœ¡ë°•í•´ë„ ë¬¸ì œì—†ì´ ì •í™•í•œ íƒ€ì´ë°ì— callë˜ê³ 
ê°„í˜¹ ëŠë¦¬ê³  í¸ì°¨ê°€ í° ì„œë¹„ìŠ¤ë¥¼ ì½œë§í•˜ì—¬ ì‹¤ì§ˆtpsê°€ ê°€ëŠ ì´ ì•ˆì¡íë•ŒëŠ” adaptiveê°€ ì‘ë™í•˜ë©°
ìˆ˜ë ´ë  ê²ƒì´ë‹¤.</p>
<h2 id="5-ìƒê°">5. ìƒê°</h2>
<p>ìµœê·¼ aië“¤ì˜ ì„±ëŠ¥ì´ 25ë…„ í•˜ë°˜ê¸°ì— ê¸‰ê²©í•˜ê²Œ ì¢‹ì•„ì§€ë©° ëŒ€ë¶€ë¶„ì˜ ê°œë°œì ì½”ë”©ëŠ¥ë ¥ì„ ë„˜ì–´ì„  ê²ƒ ê°™ë‹¤.
ì´ì œëŠ” ì—¬ëŸ¬ aië“¤ì„ ì¡°í•©í•´ì„œ ë©€í‹° ì—ì´ì „íŠ¸ë¡œ ëŒë¦°ë‹¤ê³  í•œë‹¤.
26ë…„ë„ ëª©í‘œëŠ” í›¨ì”¬ ì¹œí•´ì§€ëŠ” ê²ƒì´ ëª©í‘œ</p>

  </div>
  
  <a href="/" class="back-link">â† Back to home</a>
</div>

    </div>
    
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  </body>
</html>
